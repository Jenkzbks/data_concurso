<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Concurso - Dashboard</title>
  <!-- Para producci√≥n, usa la versi√≥n minificada: -->
  <!-- <link rel="stylesheet" href="dashboard.min.css"> -->
  <style id="main-css">
    /* ====== Look & feel ‚ÄúPower BI‚Äù ====== */
    :root{
      --bg:#f5f6f8; --card:#ffffff; --muted:#6b7280; --text:#101828; --accent:#1d4ed8; --grid:#e5e7eb;
      --card-shadow:0 10px 24px rgba(16,24,40,.06);
      --kpi-grad:linear-gradient(180deg, #f9fafb, #eef2ff);
      --tab-bg:#ffffff; --tab-active:#eef2ff; --chip:#f3f4f6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--text)}
    header{position:sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid var(--grid)}
    .wrap{max-width:1280px; margin:0 auto; padding:16px}

    h1{font-size:22px; margin:8px 0 12px}
    h2{font-size:18px; margin:0 0 10px}
    .muted{color:var(--muted)}
    .grid{display:grid; gap:16px}
    .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    @media(max-width:1100px){.grid.cols-4{grid-template-columns:repeat(2,1fr)}.grid.cols-3{grid-template-columns:repeat(2,1fr)}.grid.cols-2{grid-template-columns:1fr}}
    @media(max-width:720px){.grid.cols-4,.grid.cols-3,.grid.cols-2{grid-template-columns:1fr}}

    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .card{background:var(--card); border:1px solid var(--grid); border-radius:14px; padding:16px; box-shadow:var(--card-shadow)}
    .kpi{display:flex; flex-direction:column; gap:6px; padding:16px; border-radius:12px; background:var(--kpi-grad); border:1px solid #e9eefc}
    .kpi small{font-size:12px; color:#64748b}
    .kpi b{font-size:24px; letter-spacing:.2px}

    .btn{background:#111827; color:#fff; border:1px solid #0b1220; border-radius:10px; padding:8px 12px; cursor:pointer}
    .btn:hover{opacity:.95}
    .ghost{background:var(--chip); color:#111827; border:1px solid var(--grid)}
    input,select{background:#fff; color:#111827; border:1px solid var(--grid); border-radius:10px; padding:8px 10px}

    .tabs{display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap}
    .tab{padding:10px 14px; border-radius:10px; border:1px solid var(--grid); background:var(--tab-bg); cursor:pointer}
    .tab.active{outline:2px solid var(--accent); background:var(--tab-active)}

    .view{display:none}
    .view.active{display:block}

    table{width:100%; border-collapse:separate; border-spacing:0 8px}
    th,td{text-align:left; padding:10px 12px; vertical-align:top}
    thead th{font-size:12px; color:#374151; position:sticky; top:0; background:#fff; z-index:1}
    tbody tr{background:#fff; border:1px solid var(--grid)}
    tbody tr:hover{background:#f9fafb}
    tbody td:first-child, thead th:first-child{border-top-left-radius:8px; border-bottom-left-radius:8px}
    tbody td:last-child, thead th:last-child{border-top-right-radius:8px; border-bottom-right-radius:8px}

    .chart{width:100%; height:360px; display:block}
    .legend{display:flex; gap:10px; flex-wrap:wrap; font-size:12px; margin-top:8px}
    .legend .item{display:flex; gap:8px; align-items:center; cursor:pointer; padding:6px 8px; border-radius:8px}
    .legend .item:hover{background:#f8fafc}
    .legend .item .sw{width:12px; height:12px; border-radius:3px; display:inline-block}
    .legend.vertical{display:flex; flex-direction:column; gap:6px; align-items:flex-start}

    /* Modal */
    dialog{border:none; border-radius:16px; padding:0; width:min(740px, 92vw); background:#fff; color:#111827}
    .modal-head{padding:16px; border-bottom:1px solid var(--grid); display:flex; justify-content:space-between; align-items:center}
    .modal-body{padding:16px}
    .modal-grid{display:grid; grid-template-columns:200px 1fr; gap:8px}
    .close-x{background:transparent; border:none; color:#6b7280; font-size:20px; cursor:pointer}

    /* Heatmap-cards */
    .heatmap{display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:10px}
    .heatcell{border:1px solid var(--grid); border-radius:10px; padding:10px; background:#fff}
    .bar{height:10px; border-radius:6px; background:linear-gradient(90deg, #e5f2ff, #1d4ed8)}

    /* Header slicers */
    .slicer{display:flex; gap:8px; flex-wrap:wrap}
    .slicer .grp{display:flex; gap:6px; align-items:center; padding:8px 10px; background:#fff; border:1px solid var(--grid); border-radius:12px}
    .slicer label{font-size:12px; color:#475569}

    /* Tooltip */
    #tooltip{
      position:fixed; z-index:1000; pointer-events:none; background:#ffffff; color:#111827;
      border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; box-shadow:0 10px 24px rgba(0,0,0,.12);
      font-size:12px; line-height:1.3; transform:translate(-50%,-120%); opacity:0; transition:opacity .1s ease; white-space:nowrap
    }
    #tooltip.show{opacity:1}
    #tooltip b{font-weight:600}

    .row-split{display:flex; gap:16px; align-items:flex-start}
    .row-split .side{width:260px; flex:0 0 260px}
    .row-split .main{flex:1}

    .banner{background:#111827; color:#fff; padding:10px 16px; border-radius:12px; text-align:center; letter-spacing:.5px; font-weight:600}

    .pill{background:#eef2ff; color:#1d4ed8; padding:2px 8px; border-radius:999px; font-size:12px}
  </style>
</head>
<body>
  <!-- ====== Header con slicers estilo Power BI ====== -->
  <header>
    <div class="wrap row" style="justify-content:space-between">
      <h1 style="margin-right:auto">üìä Dashboard de Empresas</h1>
      <div class="slicer">
        <div class="grp">
          <label>√Årea</label>
          <select id="filter-area" aria-label="Filtrar por √°rea" role="listbox"><option value="">Todas</option></select>
        </div>
        <div class="grp">
          <label>Tipo</label>
          <select id="filter-tipo" aria-label="Filtrar por tipo" role="listbox"><option value="">Todos</option></select>
        </div>
        <div class="grp">
          <label>Departamento</label>
          <select id="filter-depa" aria-label="Filtrar por departamento" role="listbox"><option value="">Todos</option></select>
        </div>
        <button id="btn-clear" class="btn ghost" aria-label="Limpiar filtros" role="button">Limpiar filtros</button>
        <button id="btn-export" class="btn" aria-label="Exportar CSV filtrado" role="button">Exportar CSV (filtro)</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ====== INFORMACI√ìN GENERAL ====== -->
    <section class="card">
      <div class="banner">INFORMACI√ìN GENERAL DE PROYECTOS</div>
      <div style="height:12px"></div>
      <div class="grid cols-4">
        <div class="kpi"><small>Total registros</small><b id="kpi-total">0</b></div>
        <div class="kpi"><small>√Åreas (Final)</small><b id="kpi-areas">0</b></div>
        <div class="kpi"><small>Tipos (Final)</small><b id="kpi-tipos">0</b></div>
        <div class="kpi"><small>Contactables</small><b><span id="kpi-tel">0</span> <span class="muted">Tel</span> ‚Ä¢ <span id="kpi-mail">0</span> <span class="muted">Mail</span></b></div>
      </div>

      <div style="height:12px"></div>

      <div class="grid cols-2">
        <div class="card" style="padding:12px">
          <h2 style="margin-top:0">Por tipo de proyecto (Final) <span class="pill" id="pill-tipo">100%</span></h2>
          <svg id="chart-gen-tipo" class="chart" viewBox="0 0 800 360"></svg>
          <div id="legend-gen-tipo" class="legend"></div>
        </div>
        <div class="card" style="padding:12px">
          <h2 style="margin-top:0">Top 10 departamentos</h2>
          <svg id="chart-gen-depa" class="chart" viewBox="0 0 800 360"></svg>
          <div id="legend-gen-depa" class="legend"></div>
        </div>
      </div>
    </section>

    <!-- ====== VISTAS ====== -->
    <section class="card" style="margin-top:16px">
      <div class="tabs" role="tablist">
        <button class="tab active" data-view="v-areadpto" role="tab">Distribuci√≥n por departamento</button>
        <button class="tab" data-view="v-heatmap" role="tab">Mapa de calor (Departamentos)</button>
        <button class="tab" data-view="v-tabla" role="tab">Tabla completa</button>
      </div>

      <!-- Por Dpto (cambia √Årea/Tipo) -->
      <div class="view active" id="v-areadpto">
        <div class="row-split">
          <div class="main">
            <div class="row" style="margin-bottom:10px">
              <label class="muted">Departamento focal:</label>
              <select id="select-depa" aria-label="Seleccionar departamento focal" role="listbox"></select>
              <span class="muted" style="margin-left:12px">Agrupar por:</span>
              <select id="group-by" aria-label="Agrupar por" role="listbox">
                <option value="area_final">√Årea (Final)</option>
                <option value="tipo_final">Tipo (Final)</option>
              </select>
            </div>
            <svg id="chart-group-dpto" class="chart" viewBox="0 0 800 360"></svg>
          </div>
          <div class="side">
            <h3 style="margin:0 0 8px;font-size:14px" class="muted">Leyenda</h3>
            <div id="legend-group-dpto" class="legend vertical"></div>
          </div>
        </div>
      </div>

      <!-- Heatmap Departamentos -->
      <div class="view" id="v-heatmap">
        <div class="muted" style="margin-bottom:8px">Intensidad seg√∫n n√∫mero de registros por departamento</div>
        <div id="heatmap" class="heatmap"></div>
      </div>

      <!-- Tabla completa -->
      <div class="view" id="v-tabla">
        <div class="row" style="margin-bottom:10px">
          <input id="search" placeholder="Buscar (RUC, Raz√≥n, T√≠tulo, √Årea, Tipo‚Ä¶)" style="min-width:300px" aria-label="Buscar en la tabla" role="searchbox" />
        </div>
        <div style="overflow:auto; max-height:540px">
          <table id="table">
            <thead>
              <tr>
                <th>ID</th><th>RUC</th><th>Raz√≥n social</th><th>T√≠tulo</th><th>√Årea (Final)</th><th>Tipo de proyecto</th><th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="muted" style="margin-top:8px">Haz click en una fila para ver el detalle.</div>
      </div>
    </section>
  </main>

  <!-- ===== Modal ===== -->
  <dialog id="modal">
    <div class="modal-head">
      <div>
        <div class="muted">RUC: <span id="m-ruc">‚Äî</span></div>
        <h2 id="m-razon">‚Äî</h2>
      </div>
      <button class="close-x" onclick="document.getElementById('modal').close()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="modal-grid">
        <div class="muted">Lugar</div><div id="m-lugar"></div>
        <div class="muted">Actividad econ√≥mica</div><div id="m-actividad"></div>
        <div class="muted">Correo</div><div id="m-mail"></div>
        <div class="muted">Tel√©fono</div><div id="m-tel"></div>
        <div class="muted">√Åreas detectadas</div><div id="m-areas-det"></div>
        <!-- <div class="muted">Tipos detectados</div><div id="m-tipos-det"></div> -->
      </div>
    </div>
  </dialog>

  <!-- Tooltip -->
  <div id="tooltip"></div>

  <!-- CSV embebido (opcional) -->
  <script id="csv-data" type="text/plain"></script>

  <!-- Para producci√≥n, usa la versi√≥n minificada: -->
  <!-- <script src="dashboard.min.js"></script> -->
  <script src="dashboard.js"></script>
  <!-- SUGERENCIA: Para producci√≥n, minifica este CSS usando https://cssminifier.com/ o similar y reemplaza el contenido aqu√≠ -->
  </script>
</body>
</html>
